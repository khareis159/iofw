// --- MOTOR GRÁFICO V4.3 (FIX IMAGENS QUEBRADAS) ---
            const renderTextoComGrafico = (texto) => {
                if (!texto.includes("[[GRAFICO:") && !texto.includes("[[IMG:") && !texto.includes("[[SVG:")) {
                    return <div className="whitespace-pre-wrap font-sans">{texto}</div>;
                }

                const partes = texto.split(/(\[\[(?:GRAFICO|IMG|SVG):.*?\]\])/gs);
                
                return <div className="whitespace-pre-wrap font-sans">
                    {partes.map((parte, i) => {
                        // 1. GRÁFICOS
                        if (parte.startsWith("[[GRAFICO:")) {
                            try {
                                const conteudo = parte.replace("[[GRAFICO:", "").replace("]]", "");
                                const params = Object.fromEntries(conteudo.split(', ').map(s => {
                                    const parts = s.split('=');
                                    return [parts[0].trim(), parts.slice(1).join('=').trim() || ""];
                                }));
                                
                                const labels = params.labels ? params.labels.split(',').map(s => s.trim()) : [];
                                const dataValues = params.dados ? params.dados.split(',').map(s => Number(s.trim())) : [];
                                let chartType = (params.tipo || 'bar').toLowerCase();
                                if (['pizza', 'torta'].includes(chartType)) chartType = 'pie';
                                if (['rosca', 'anel'].includes(chartType)) chartType = 'doughnut';
                                if (['linha', 'linhas'].includes(chartType)) chartType = 'line';
                                
                                const qcConfig = {
                                    type: chartType,
                                    data: {
                                        labels: labels,
                                        datasets: [{
                                            label: "Dados",
                                            data: dataValues,
                                            backgroundColor: ['#238636', '#8957e5', '#d4af37', '#ef4444', '#3b82f6', '#ffffff'],
                                            borderColor: '#0d1117',
                                            borderWidth: 2
                                        }]
                                    },
                                    options: {
                                        legend: { display: (chartType !== 'bar'), labels: { fontColor: '#fff' } },
                                        title: { display: true, text: params.titulo || 'OESD Analytics', fontColor: '#fff' },
                                        scales: {
                                            yAxes: (chartType === 'bar' || chartType === 'line') ? [{ ticks: { fontColor: '#fff', beginAtZero: true }, gridLines: { color: '#30363d' } }] : [],
                                            xAxes: (chartType === 'bar' || chartType === 'line') ? [{ ticks: { fontColor: '#fff' }, gridLines: { color: '#30363d' } }] : []
                                        }
                                    }
                                };
                                const url = `https://quickchart.io/chart?c=${encodeURIComponent(JSON.stringify(qcConfig))}&bkg=transparent&width=500&height=300&devicePixelRatio=1.0`;
                                return <div key={i} className="my-4 bg-[#0d1117] p-2 rounded border border-[#30363d] shadow-lg flex justify-center"><img src={url} alt="Chart" className="rounded max-w-full h-auto"/></div>;
                            } catch (e) { return null; }
                        }

                        // 2. FOTOS REAIS (Com Proteção de Link)
                        if (parte.startsWith("[[IMG:")) {
                            let rawPrompt = parte.replace("[[IMG:", "").replace("]]", "").trim();
                            
                            // LIMPEZA CRÍTICA PARA NÃO QUEBRAR
                            // Remove quebras de linha e limita a 300 caracteres para a URL não estourar
                            let safePrompt = rawPrompt.replace(/[\r\n]+/g, " ").substring(0, 300);
                            
                            const url = `https://image.pollinations.ai/prompt/${encodeURIComponent(safePrompt)}?width=800&height=600&model=flux&nologo=true&seed=${Math.floor(Math.random()*1000)}`;
                            
                            return (
                                <div key={i} className="my-4 border border-[#30363d] rounded-lg overflow-hidden relative group">
                                    <div className="absolute top-2 left-2 bg-black/60 text-[10px] text-neon px-2 py-1 rounded backdrop-blur font-mono border border-[#30363d]">IMAGINAÇÃO ESTÉTICA</div>
                                    <img src={url} alt="Gerando..." className="w-full object-cover min-h-[200px] bg-[#161b22]" loading="lazy" />
                                </div>
                            );
                        }

                        // 3. VETORES SVG
                        if (parte.startsWith("[[SVG:")) {
                            let svgCode = parte.replace("[[SVG:", "").replace("]]", "").trim();
                            return <div key={i} className="my-4 bg-[#161b22] p-6 rounded border border-[#30363d] flex justify-center items-center" dangerouslySetInnerHTML={{ __html: svgCode }} />;
                        }

                        return <span key={i}>{parte}</span>;
                    })}
                </div>;
            };




