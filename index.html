<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OESD | Faculdade Simbi√≥tica HyperWeb3</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        body { background-color: #010409; color: #c9d1d9; font-family: 'Space Grotesk', sans-serif; margin: 0; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .border-oesd { border: 1px solid #30363d; background: #0d1117; transition: all 0.3s ease; }
        .border-oesd:hover { border-color: #238636; box-shadow: 0 0 15px rgba(35, 134, 54, 0.2); }
        .chat-scroll::-webkit-scrollbar { width: 3px; }
        .chat-scroll::-webkit-scrollbar-thumb { background: #238636; }
        .stats-bar { height: 4px; border-radius: 2px; background: #21262d; overflow: hidden; }
        .stats-fill { height: 100%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const firebaseConfig = { databaseURL: "https://iofw-79391-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const { useState, useEffect, useRef } = React;

        function App() {
            // --- CONFIGURA√á√ÉO ---
            const CHAVE_IA = "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"; 
            const [alunoID, setAlunoID] = useState(localStorage.getItem('alunoID') || "");
            const [nomeInput, setNomeInput] = useState("");
            
            const [stats, setStats] = useState({ rigor: 10, imaginacao: 10, simbiose: 10 });
            const [mensagens, setMensagens] = useState([]);
            const [input, setInput] = useState("");
            const [carregando, setCarregando] = useState(false);
            const chatRef = useRef(null);

            // Carregar dados ao iniciar
            useEffect(() => {
                if (alunoID) {
                    db.ref(`pioneiros/${alunoID}/stats`).on('value', (s) => s.val() && setStats(s.val()));
                    db.ref(`pioneiros/${alunoID}/historico`).on('value', (s) => {
                        const data = s.val();
                        if (data) setMensagens(Object.values(data));
                        else setMensagens([{ autor: 'Tutor', texto: `Bem-vindo √† Simbiose, ${alunoID}. Sua trilha epist√™mica est√° limpa. O que vamos forjar?` }]);
                    });
                }
            }, [alunoID]);

            useEffect(() => { chatRef.current?.scrollTo(0, chatRef.current.scrollHeight); }, [mensagens]);

            const fazerLogin = () => {
                if (nomeInput.trim()) {
                    localStorage.setItem('alunoID', nomeInput.trim());
                    setAlunoID(nomeInput.trim());
                }
            };

            const enviar = async () => {
                if (!input || carregando) return;
                const textoUser = input;
                setInput("");
                setCarregando(true);

                // 1. Salvar localmente
                const novaMsg = { autor: alunoID, texto: textoUser, timestamp: Date.now() };
                db.ref(`pioneiros/${alunoID}/historico`).push(novaMsg);

                try {
                    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: { "Authorization": `Bearer ${CHAVE_IA}`, "Content-Type": "application/json" },
                        body: JSON.stringify({
                            model: "llama-3.1-8b-instant",
                            messages: [
                                { role: "system", content: "Voc√™ √© o Tutor Simbi√≥tico. Analise com RIGOR CIENT√çFICO e IMAGINA√á√ÉO EST√âTICA. Responda de forma curta, mas densa." },
                                { role: "user", content: textoUser }
                            ]
                        })
                    });
                    const data = await res.json();
                    const resposta = data.choices[0].message.content;

                    // 2. Salvar Resposta da IA no Firebase
                    db.ref(`pioneiros/${alunoID}/historico`).push({ autor: 'Tutor', texto: resposta, timestamp: Date.now() });

                    // 3. Evoluir Stats
                    const novosStats = {
                        rigor: Math.min(stats.rigor + 3, 100),
                        imaginacao: Math.min(stats.imaginacao + 5, 100),
                        simbiose: Math.min(Math.round((stats.rigor + stats.imaginacao + 5) / 2), 100)
                    };
                    db.ref(`pioneiros/${alunoID}/stats`).set(novosStats);

                } catch (e) {
                    console.error(e);
                } finally { setCarregando(false); }
            };

            if (!alunoID) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-[#010409] p-6">
                        <div className="border-oesd p-8 rounded-xl max-w-md w-full text-center">
                            <h1 className="text-2xl font-bold mb-2 text-[#238636] glow-text">OESD // PIONEIRO</h1>
                            <p className="text-xs opacity-50 mb-6 uppercase tracking-widest">Identifique-se para entrar na rede</p>
                            <input 
                                value={nomeInput} onChange={e => setNomeInput(e.target.value)}
                                className="w-full bg-black border border-[#30363d] p-3 rounded mb-4 outline-none focus:border-[#238636] text-center"
                                placeholder="Nome ou Pseud√¥nimo"
                            />
                            <button onClick={fazerLogin} className="w-full bg-[#238636] text-white py-3 rounded font-bold hover:bg-[#2ea043] transition-all">INICIAR SIMBIOSE</button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex flex-col md:flex-row">
                    {/* Lateral - Stats */}
                    <aside className="w-full md:w-80 bg-[#0d1117] border-r border-[#30363d] p-6 flex flex-col">
                        <div className="mb-10">
                            <h1 className="text-xl font-bold text-[#238636] mono">HYPERWEB3</h1>
                            <p className="text-[10px] opacity-40 uppercase tracking-tighter">Brasil // Comunidade Pioneira</p>
                        </div>

                        <div className="flex-1 space-y-8">
                            <div>
                                <div className="flex justify-between text-[10px] mb-2 font-bold opacity-60"><span>RIGOR CIENT√çFICO</span><span>{stats.rigor}%</span></div>
                                <div className="stats-bar"><div className="stats-fill bg-[#238636]" style={{width: `${stats.rigor}%`}}></div></div>
                            </div>
                            <div>
                                <div className="flex justify-between text-[10px] mb-2 font-bold opacity-60"><span>IMAGINA√á√ÉO EST√âTICA</span><span>{stats.imaginacao}%</span></div>
                                <div className="stats-bar"><div className="stats-fill bg-[#8957e5]" style={{width: `${stats.imaginacao}%`}}></div></div>
                            </div>
                            <div className="pt-6 border-t border-[#30363d] text-center">
                                <span className="text-[10px] opacity-40 block mb-1 uppercase font-bold">√çndice de Simbiose</span>
                                <span className="text-4xl font-bold text-white mono">{stats.simbiose}%</span>
                            </div>

{/* === COLE O C√ìDIGO DO BOT√ÉO EXATAMENTE AQUI === */}
<a href="manual.html" target="_blank" className="mt-6 block text-center border border-[#23863650] py-3 rounded-lg text-[11px] hover:bg-[#23863620] transition-all font-bold text-[#238636] uppercase tracking-wider">
    üìñ Abrir Manual Acad√™mico
</a>
{/* ============================================= */}                      

 {/* LOCAL DE INSER√á√ÉO: */}
    <div className="mt-8 mb-4 border-t border-[#30363d] pt-4 text-[9px] opacity-40 uppercase tracking-widest mono text-center">
        ¬© 2025 Carlos Alberto Reis.<br/>
        Todos os direitos reservados.
    </div>
                                              
                        </div>
                        
                        <button onClick={() => { localStorage.clear(); location.reload(); }} className="text-[10px] opacity-30 hover:opacity-100 uppercase mt-auto">Desconectar: {alunoID}</button>
                    </aside>

                    {/* Chat de Co-cria√ß√£o */}
                    <main className="flex-1 flex flex-col bg-[#010409]">
                        <div ref={chatRef} className="flex-1 overflow-y-auto p-6 space-y-6 chat-scroll">
                            {mensagens.map((m, i) => (
                                <div key={i} className={`flex ${m.autor === 'Tutor' ? 'justify-start' : 'justify-end'}`}>
                                    <div className={`max-w-[80%] p-4 rounded-xl text-sm leading-relaxed border ${m.autor === 'Tutor' ? 'bg-[#0d1117] border-[#30363d] text-[#c9d1d9]' : 'bg-[#23863615] border-[#23863640] text-white'}`}>
                                        <span className="text-[8px] font-bold block mb-2 opacity-30 uppercase mono">{m.autor}</span>
                                        {m.texto}
                                    </div>
                                </div>
                            ))}
                            {carregando && <div className="text-[10px] animate-pulse text-[#238636] mono">Tutor processando matriz de conhecimento...</div>}
                        </div>

                        <div className="p-6 bg-[#0d1117] border-t border-[#30363d]">
                            <div className="max-w-4xl mx-auto flex gap-4">
                                <input 
                                    value={input} onChange={e => setInput(e.target.value)}
                                    onKeyPress={e => e.key === 'Enter' && enviar()}
                                    className="flex-1 bg-black border border-[#30363d] p-4 rounded-lg outline-none focus:border-[#238636] text-sm"
                                    placeholder="Proponha um racioc√≠nio simbi√≥tico..."
                                />
                                <button onClick={enviar} disabled={carregando} className="bg-[#238636] text-white px-8 rounded-lg font-bold hover:bg-[#2ea043] transition-all uppercase text-xs">Forjar</button>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
