<!-- 
    COPYRIGHT: ¬© 2025 Carlos Alberto Reis 
    PROJECT: Faculdade Simbi√≥tica HyperWeb3 
    METHODOLOGY: OESD (Ordem Epistemol√≥gica de Simbiose Digital)
    PHASE: 2 - APP CONSOLIDADO
-->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OESD | Faculdade Simbi√≥tica HyperWeb3</title>
    
    <!-- Bibliotecas de Alta Performance -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap');
        
        body { background-color: #010409; color: #c9d1d9; font-family: 'Space Grotesk', sans-serif; margin: 0; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .border-oesd { border: 1px solid #30363d; background: #0d1117; transition: all 0.3s ease; }
        .border-oesd:hover { border-color: #238636; box-shadow: 0 0 15px rgba(35, 134, 54, 0.1); }
        
        .chat-scroll::-webkit-scrollbar { width: 3px; }
        .chat-scroll::-webkit-scrollbar-thumb { background: #238636; border-radius: 10px; }
        
        .stats-bar { height: 4px; border-radius: 2px; background: #21262d; overflow: hidden; }
        .stats-fill { height: 100%; transition: width 1s cubic-bezier(0.4, 0, 0.2, 1); }
        
        .glow-green { text-shadow: 0 0 10px #238636; }
        .medal-animate { animation: appear 0.5s ease-out forwards; }
        @keyframes appear { from { opacity: 0; transform: scale(0.5); } to { opacity: 1; transform: scale(1); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Configura√ß√£o Segura do Firebase
        const firebaseConfig = { databaseURL: "https://iofw-79391-default-rtdb.firebaseio.com/" };
        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const { useState, useEffect, useRef } = React;

        function App() {
            // --- N√öCLEO DE CONFIGURA√á√ÉO ---
            const CHAVE_IA = "COLE_AQUI_SUA_CHAVE_GSK"; 
            const [alunoID, setAlunoID] = useState(localStorage.getItem('alunoID') || "");
            const [nomeInput, setNomeInput] = useState("");
            
            const [stats, setStats] = useState({ rigor: 10, imaginacao: 10, simbiose: 10 });
            const [mensagens, setMensagens] = useState([]);
            const [input, setInput] = useState("");
            const [carregando, setCarregando] = useState(false);
            const chatRef = useRef(null);

            // Sincroniza√ß√£o em Tempo Real com Firebase
            useEffect(() => {
                if (alunoID) {
                    db.ref(`pioneiros/${alunoID}/stats`).on('value', (s) => s.val() && setStats(s.val()));
                    db.ref(`pioneiros/${alunoID}/historico`).on('value', (s) => {
                        const data = s.val();
                        if (data) setMensagens(Object.values(data));
                        else setMensagens([{ autor: 'Tutor', texto: `Sauda√ß√µes, ${alunoID}. A Matriz Simbi√≥tica est√° pronta. Qual lacuna da antropologia realista vamos preencher hoje?` }]);
                    });
                }
            }, [alunoID]);

            // Auto-scroll do chat
            useEffect(() => { chatRef.current?.scrollTo(0, chatRef.current.scrollHeight); }, [mensagens]);

            const fazerLogin = () => {
                if (nomeInput.trim()) {
                    localStorage.setItem('alunoID', nomeInput.trim());
                    setAlunoID(nomeInput.trim());
                }
            };

            const exportarLegado = () => {
                const conteudo = mensagens.map(m => `[${m.autor.toUpperCase()}]: ${m.texto}`).join('\n\n');
                const cabecalho = `FACULDADE √çNTEGRA - LEGADO OESD\nAUTOR: ${alunoID}\nDATA: ${new Date().toLocaleDateString()}\nSIMBIOSE: ${stats.simbiose}%\n------------------------------------------\n\n`;
                const blob = new Blob([cabecalho + conteudo], { type: 'text/plain' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `Legado_OESD_${alunoID}.txt`;
                link.click();
            };

            const enviar = async () => {
                if (!input || carregando) return;
                const textoUser = input;
                setInput("");
                setCarregando(true);

                // Grava no Firebase o input do aluno
                const novaMsg = { autor: alunoID, texto: textoUser, timestamp: Date.now() };
                db.ref(`pioneiros/${alunoID}/historico`).push(novaMsg);

                try {
                    const res = await fetch("https://api.groq.com/openai/v1/chat/completions", {
                        method: "POST",
                        headers: { "Authorization": `Bearer ${CHAVE_IA}`, "Content-Type": "application/json" },
                        body: JSON.stringify({
                            model: "llama-3.1-8b-instant",
                            messages: [
                                { role: "system", content: "Voc√™ √© o Tutor Simbi√≥tico. Sua miss√£o √© equilibrar a Antropologia Realista com a Idealista. Use rigor cient√≠fico absoluto e imagina√ß√£o est√©tica em suas respostas." },
                                { role: "user", content: textoUser }
                            ]
                        })
                    });
                    const data = await res.json();
                    const resposta = data.choices[0].message.content;

                    // Grava no Firebase a resposta do Tutor
                    db.ref(`pioneiros/${alunoID}/historico`).push({ autor: 'Tutor', texto: resposta, timestamp: Date.now() });

                    // Evolu√ß√£o de Stats baseada na intera√ß√£o
                    const novosStats = {
                        rigor: Math.min(stats.rigor + 3, 100),
                        imaginacao: Math.min(stats.imaginacao + 5, 100),
                        simbiose: Math.min(Math.round((stats.rigor + stats.imaginacao + 5) / 2), 100)
                    };
                    db.ref(`pioneiros/${alunoID}/stats`).set(novosStats);

                } catch (e) {
                    console.error("Erro na IA:", e);
                } finally { setCarregando(false); }
            };

            // TELA DE LOGIN (PIONEIRO)
            if (!alunoID) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-[#010409] p-6">
                        <div className="border-oesd p-10 rounded-2xl max-w-md w-full text-center shadow-2xl">
                            <h1 className="text-3xl font-bold mb-2 text-[#238636] mono glow-green tracking-tighter">OESD // PIONEIRO</h1>
                            <p className="text-[10px] opacity-50 mb-8 uppercase tracking-[0.4em]">Faculdade Simbi√≥tica HyperWeb3</p>
                            <input 
                                value={nomeInput} onChange={e => setNomeInput(e.target.value)}
                                onKeyPress={e => e.key === 'Enter' && fazerLogin()}
                                className="w-full bg-black border border-[#30363d] p-4 rounded-lg mb-4 outline-none focus:border-[#238636] text-center text-white"
                                placeholder="Nome ou Pseud√¥nimo"
                            />
                            <button onClick={fazerLogin} className="w-full bg-[#238636] text-white py-4 rounded-lg font-bold hover:bg-[#2ea043] transition-all uppercase text-xs tracking-widest">Acessar Matriz</button>
                            <p className="mt-6 text-[9px] opacity-30 mono uppercase">¬© 2025 Carlos Alberto Reis</p>
                        </div>
                    </div>
                );
            }

            // DASHBOARD PRINCIPAL (FASE 2)
            return (
                <div className="h-screen flex flex-col md:flex-row">
                    
                    {/* BARRA LATERAL (SIDEBAR) */}
                    <aside className="w-full md:w-80 bg-[#0d1117] border-r border-[#30363d] p-6 flex flex-col overflow-y-auto chat-scroll">
                        <div className="mb-8">
                            <h1 className="text-xl font-bold text-[#238636] mono tracking-tighter">HYPERWEB3</h1>
                            <p className="text-[9px] opacity-40 uppercase tracking-widest">Soberania Epist√™mica</p>
                        </div>

                        {/* Painel de Atributos */}
                        <div className="space-y-6">
                            <div>
                                <div className="flex justify-between text-[10px] mb-2 font-bold opacity-60"><span>RIGOR CIENT√çFICO</span><span>{stats.rigor}%</span></div>
                                <div className="stats-bar"><div className="stats-fill bg-[#238636]" style={{width: `${stats.rigor}%`}}></div></div>
                            </div>
                            <div>
                                <div className="flex justify-between text-[10px] mb-2 font-bold opacity-60"><span>IMAGINA√á√ÉO EST√âTICA</span><span>{stats.imaginacao}%</span></div>
                                <div className="stats-bar"><div className="stats-fill bg-[#8957e5]" style={{width: `${stats.imaginacao}%`}}></div></div>
                            </div>
                            <div className="pt-6 border-t border-[#30363d] text-center">
                                <span className="text-[10px] opacity-40 block mb-1 uppercase font-bold tracking-widest">√çndice de Simbiose</span>
                                <span className="text-5xl font-bold text-white mono">{stats.simbiose}%</span>
                            </div>
                        </div>

                        {/* Bot√µes de A√ß√£o Fase 2 */}
                        <div className="mt-8 space-y-3">
                            <a href="manual.html" target="_blank" className="block text-center border border-[#23863650] py-3 rounded-lg text-[10px] hover:bg-[#23863620] transition-all font-bold text-[#238636] uppercase tracking-wider">
                                üìñ Manual Acad√™mico
                            </a>
                            <button onClick={exportarLegado} className="w-full text-center bg-[#8957e515] border border-[#8957e540] py-3 rounded-lg text-[10px] hover:bg-[#8957e530] transition-all font-bold text-[#8957e5] uppercase tracking-wider">
                                üìú Exportar Legado
                            </button>
{/* BOT√ÉO DE INTEGRA√á√ÉO COM A BIBLIOTECA KHAREISBOOK */}
<button 
    onClick={() => {
        const titulo = prompt("D√™ um t√≠tulo para este volume da biblioteca (ex: Antropologia Realista vs Idealista):");
        if(titulo) {
            db.ref('mural_publico').push({
                titulo: titulo,
                autor: alunoID,
                data: new Date().toLocaleDateString(),
                resumo: mensagens[mensagens.length - 1].texto.substring(0, 150) + "...",
                link_origem: window.location.href,
                simbiose: stats.simbiose,
                timestamp: Date.now()
            });
            alert("Sucesso! Este conhecimento foi enviado para a fila de curadoria da Biblioteca KhareisBook.");
        }
    }}
    className="w-full text-center bg-[#23863615] border border-[#23863650] py-3 rounded-lg text-[10px] hover:bg-[#23863630] transition-all font-bold text-[#238636] uppercase tracking-wider mt-2"
>
    üåê Publicar na Biblioteca Viva
</button>
                        
                        </div>

                        {/* Painel de Medalhas (Conquistas) */}
                        <div className="mt-8 border-t border-[#30363d] pt-6">
                            <h3 className="text-[10px] font-bold opacity-40 mb-4 uppercase tracking-widest">C√©lulas de Carreira</h3>
                            <div className="flex flex-wrap gap-2">
                                {stats.rigor >= 20 && <span className="medal-animate bg-[#23863620] border border-[#23863670] text-[#238636] text-[8px] px-2 py-1 rounded font-bold">‚úì REALISTA</span>}
                                {stats.imaginacao >= 20 && <span className="medal-animate bg-[#8957e520] border border-[#8957e570] text-[#8957e5] text-[8px] px-2 py-1 rounded font-bold">‚úì ESTETA</span>}
                                {stats.simbiose >= 50 && <span className="medal-animate bg-white text-black text-[8px] px-2 py-1 rounded font-black animate-pulse uppercase">Mestre OESD</span>}
                            </div>
                        </div>

                        {/* COPYRIGHT FOOTER */}
                        <footer className="mt-auto pt-8 text-center border-t border-[#30363d]">
                            <p className="text-[9px] opacity-30 uppercase tracking-[0.2em] leading-relaxed mono">
                                ¬© 2025 Carlos Alberto Reis<br/>
                                <span className="text-[7px]">Propriedade Intelectual Protegida</span>
                            </p>
                            <button onClick={() => { localStorage.clear(); location.reload(); }} className="mt-4 text-[8px] opacity-20 hover:opacity-100 uppercase transition-all">Sair: {alunoID}</button>
                        </footer>
                    </aside>

                    {/* √ÅREA DE CHAT (INTERFACE DE FORJA) */}
                    <main className="flex-1 flex flex-col bg-[#010409]">
                        <header className="p-4 border-b border-[#30363d] flex justify-between items-center bg-[#0d1117]/50 backdrop-blur-md">
                            <span className="text-[10px] mono opacity-50 uppercase tracking-widest">Laborat√≥rio de Co-cria√ß√£o // Online</span>
                            <div className="flex items-center gap-2">
                                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span className="text-[10px] mono opacity-50">Link: iofw-79391</span>
                            </div>
                        </header>

                        <div ref={chatRef} className="flex-1 overflow-y-auto p-6 space-y-8 chat-scroll bg-grid">
                            {mensagens.map((m, i) => (
                                <div key={i} className={`flex ${m.autor === 'Tutor' ? 'justify-start' : 'justify-end'}`}>
                                    <div className={`max-w-[85%] p-5 rounded-2xl text-sm leading-relaxed border transition-all ${m.autor === 'Tutor' ? 'bg-[#0d1117] border-[#30363d] text-[#c9d1d9] shadow-lg' : 'bg-[#23863610] border-[#23863640] text-white'}`}>
                                        <span className={`text-[8px] font-bold block mb-3 uppercase tracking-widest mono ${m.autor === 'Tutor' ? 'text-[#8957e5]' : 'text-[#238636]'}`}>{m.autor}</span>
                                        <div className="whitespace-pre-wrap">{m.texto}</div>
                                    </div>
                                </div>
                            ))}
                            {carregando && <div className="text-[10px] animate-pulse text-[#238636] mono text-center uppercase tracking-widest">Sincronizando com a Matriz de Conhecimento...</div>}
                        </div>

                        {/* Campo de Entrada */}
                        <div className="p-6 bg-[#0d1117] border-t border-[#30363d] shadow-2xl">
                            <div className="max-w-4xl mx-auto flex gap-4">
                                <input 
                                    value={input} onChange={e => setInput(e.target.value)}
                                    onKeyPress={e => e.key === 'Enter' && enviar()}
                                    className="flex-1 bg-black border border-[#30363d] p-4 rounded-xl outline-none focus:border-[#238636] text-sm text-emerald-50 placeholder-gray-600 transition-all"
                                    placeholder="Proponha um racioc√≠nio, desafie a l√≥gica ou co-crie..."
                                />
                                <button onClick={enviar} disabled={carregando} className="bg-[#238636] text-white px-10 rounded-xl font-bold hover:bg-[#2ea043] transition-all uppercase text-[10px] tracking-widest disabled:opacity-20">Forjar</button>
                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
